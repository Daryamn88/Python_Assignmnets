# Darya Mansouri
# 101394900
# Assignment 1

# Initiating the arrays
employees = []
items = []

# Checks for empty inputs
def get_valid_input(prompt_message):
    while True:
        user_input = input(prompt_message).lower()
        if user_input == "no":
            print("Exiting The Program.")
            return None
        elif user_input:
            return user_input
        print("Input Cannot Be Empty. Please Try Again.")

# Checks for specific types of input
def get_valid_type(prompt_message, types):
    while True:
        user_input = input(prompt_message).lower()
        if user_input == "no":
            print("Exiting The Program.")
            return None
        elif user_input and user_input in types:
            return user_input
        print("Please Enter One of These Following Values " + ', '.join(types))

# Checks if input is an integer
def get_valid_number(prompt_message):
    while True:
        user_input = input(prompt_message).lower()
        if user_input == "no":
            print("Exiting The Program.")
            return None
        elif user_input and user_input.isnumeric():
            return int(user_input)
        print("Please Enter A Number.")

# Checks for employee id
def check_employee_exists(employeeId):
    for employee in employees:
        if employee[0] == employeeId:
            return True
    return False

#unique discount number
def check_discount_number_exists(discount_code):
    for employee in employees:
        if employee[6] == discount_code:
            return True
    return False

#check if item id exists
def check_item_exists(itemId):
    for item in items:
        if item[0] == itemId:
            return True
    return False

# display the item list
def display_items():
  print("Item Number | Item Name         | Item Cost")
  for item in items:
    print("| {:<10} | {:<20} | ${:<10.2f} ".format(item[0], item[1], item[2]))



# Checks if they are done with the program or they want to go back to the main menu
def mini_menu(prompt_message):
    while True:
        user_input = get_valid_number(prompt_message)
        if user_input == 1:
            print("Thank You For Using My Application.")
            exit()
        elif user_input == 2:
            print("Returning to The Main Menu.")
            display_menu()
        else:
            print("Invalid Choice")

# Creating the employees
def create_employee():
    is_continue = True
    while is_continue:
        employee_id = get_valid_number("Enter Employee ID: ")
        if employee_id is None:
            break
        else:
            if check_employee_exists(employee_id):
                print("Employee ID Exists, Please Enter A new One.")
            else:
                employee_name = get_valid_input("Enter Employee Name: ")
                if employee_name is None:
                     break
                else:
                    employee_type = get_valid_type("Enter Employee Type: ", ["hourly", "manager"])
                    if employee_type is None:
                        break
                    else:
                        employee_years_worked = get_valid_number("Enter Employee Total Years Worked: ")
                        if employee_years_worked is None:
                            break
                        else:
                          go = True
                          while go:
                            employee_discount_number = get_valid_number("Enter Employee Discount Number: ")
                            if employee_discount_number is None:
                                break
                            else:
                                if check_discount_number_exists(employee_discount_number):
                                    print("This Discount number already exists. Please try with another number.")
                                else:
                                    employees.append([employee_id, employee_name, employee_type, employee_years_worked, 0, 0, employee_discount_number])
                                    print("Employee with ID " + str(employee_id) + " is successfully added.")
                                    go = False

                                    while True:
                                        user_input = get_valid_input("Would you like to add another employee? (Y/N): ").upper()
                                        if user_input == "N":
                                            print("Do You Want To Return To The Main Menu Or Exit The Program?")
                                            print("1) Exit      2) Main Menu")
                                            mini_menu("Enter Your Choice: ")
                                            is_continue = False
                                            break
                                        elif user_input == "Y":
                                            break
                                        else:
                                            print("Invalid choice. Please enter 'Y' or 'N'.")

#creatinng Item
def create_item():
    is_continue = True
    while is_continue:
        item_id = get_valid_number("Enter Item ID: ")
        if item_id is None:
            break
        else:
            if check_item_exists(item_id):
                print("Item ID Exists, Please Enter A new One.")
            else:
                item_name = get_valid_input("Enter Item Name: ")
                if item_name is None:
                    break
                else:
                    item_cost = get_valid_number("Enter Item Cost: ")
                    if item_cost is None:
                        break
                    else:
                        items.append([item_id, item_name, item_cost])
                        print("Item with ID " + str(item_id) + " is successfully added.")

                        while True:
                            user_input = get_valid_input("Would You Like To Add Another Item? (Y/N): ").upper()
                            if user_input == "N":
                                print("Do You Want To Return To The Main Menu Or Exit The Program?")
                                print("1) Exit      2) Main Menu")
                                mini_menu("Enter Your Choice: ")
                                is_continue = False
                                break
                            elif user_input == "Y":
                                break
                            else:
                                print("Invalid choice. Please enter 'Y' or 'N'.")


#calculating and saving the purchases
def make_purchase():
  while True:
    display_items()
    employee_discount_number = get_valid_number("Enter Employee Discount Number: ")
    if employee_discount_number is None:
      break
    else:
      if not check_discount_number_exists(employee_discount_number):
        print("Employee Discount Number Does Not Exist.")
      else:
        item_number = get_valid_number("Enter Item ID: ")
        if item_number is None:
          break
        else:
          if not check_item_exists(item_number):
            print("Item ID Does Not Exist.")
          else:
            while True:
                    confirm_purchase = get_valid_input("Would You Like To Confirm Your Purchase? (Y/N): ").upper()
                    if confirm_purchase is None:
                      break
                    else:
                      if confirm_purchase == "N":
                          another_purchase = get_valid_input("Would You Like To Make A New Purchase? (Y/N): ").upper()
                          if another_purchase is None:
                            break
                          else:
                            if another_purchase == "N":
                                print("Here Is The Summary Of Your Employees.")
                                employee_summary()
                                print("Do You Want To Return To The Main Menu Or Exit The Program?")
                                print("1) Exit      2) Main Menu")
                                mini_menu("Enter Your Choice: ")
                                break
                            elif another_purchase == "Y":
                                break
                            else:
                                print("Invalid choice. Please enter 'Y' or 'N'.")
                      elif confirm_purchase == "Y":
                          item = None
                          for item_data in items:
                              if item_data[0] == item_number:
                                  item = item_data
                                  break
                          employee = None
                          for emp_data in employees:
                              if emp_data[6] == employee_discount_number:
                                  employee = emp_data
                                  break
                          # 2% discount per year, maximum 10%
                          discount_rate = 0.02 * min(employee[3], 5)
                          # checking the employee type, 10% additional discount for managers
                          if employee[2] == "manager":
                              discount_rate += 0.1
                          elif employee[2] == "hourly":
                          # 2% additional discount for hourly employees
                              discount_rate += 0.02
                          # Total discount capped at $200
                          total_discount = min(employee[5] + item[2], 200)
                          total_cost = item[2] * (1 - discount_rate)
                          # Update total discount for the employee
                          employee[5] = total_discount
                          # Update total purchased for the employee
                          employee[4] += total_cost
                          print("Purchase Successful!")
                          print(f"Item: {item[1]}, Cost: ${total_cost:.2f}")
                          another_purchase2 = get_valid_input("Would You Like To Make A New Purchase? (Y/N): ").upper()
                          if another_purchase2 is None:
                            break
                          else:
                            if another_purchase2 == "N":
                                print("Here Is The Summary Of Your Employees.")
                                employee_summary()
                                print("Do You Want To Return To The Main Menu Or Exit The Program?")
                                print("1) Exit      2) Main Menu")
                                mini_menu("Enter Your Choice: ")
                                break
                            elif another_purchase2 == "Y":
                                break
                            else:
                                print("Invalid choice. Please enter 'Y' or 'N'.")
                      else:
                       print("Invalid choice. Please enter 'Y' or 'N'.")

def employee_summary():
    #display list of employees and their info
    print("Employee ID | Employee Name    | Employee Type | Years Worked | Total Purchased | Total Discount | Employee Discount Number")
    for employee in employees:
        print("| {:<11} | {:<16} | {:<13} | {:<12} | ${:<15.2f} | ${:<14.2f} | {:<21} |".format(employee[0], employee[1], employee[2], employee[3], employee[4], employee[5], employee[6]))

    print("Do You Want To Return To The Main Menu Or Exit The Program?")
    print("1) Exit      2) Main Menu")
    mini_menu("Enter Your Choice: ")


def display_menu():
    while True:
        menu_items = ["1. Create Employee",
                      "",
                      "2. Create Item",
                      "",
                      "3. Make Purchase",
                      "",
                      "4. All Employee Summary",
                      "",
                      "5. Exit"]
        print("-" * 95)
        for item in menu_items:
            print("| {:<90} |".format(item))
        print("-" * 95)
        menu_input = get_valid_input("Please enter your choice: ")
        # checking menu input is valid
        input_m = [1, 2, 3, 4, 5]
        if menu_input is not None:
            try:
                menu_input = int(menu_input)
            except ValueError:
                print("Invalid input. Please enter a valid integer.")
                continue
            if menu_input in input_m:
                if menu_input == 1:
                    create_employee()
                elif menu_input == 2:
                    create_item()
                elif menu_input == 3:
                    make_purchase()
                elif menu_input == 4:
                    employee_summary()
                elif menu_input == 5:
                    print("Thank You For Using My Application.")
                    return
            else:
                print("Invalid Input. Please Enter A Valid Choice.")
        else:
              return
display_menu()
